<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProAccount v4</title>
</head>
<body>

<div id="login-view">
  <h2>ProAccount Login</h2>
  <input id="log-user" placeholder="Kullanıcı Adı">
  <input id="log-pass" type="password" placeholder="Şifre">
  <button onclick="app.apiAction('LOGIN')">Giriş Yap</button>
</div>

<div id="app-view" style="display:none">
  <h2>Hoşgeldin <span id="user-tag"></span></h2>
  <button onclick="location.reload()">Çıkış</button>
</div>

<script>
const app = {
  user: null,

  apiAction: async (action) => {
    const payload = app.getPayload(action);

    try {
      const response = await fetch('/.netlify/functions/api', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, payload })
      });

      const data = await response.json();

      if (!response.ok) {
        alert(data.error || 'Hata oluştu');
        return;
      }

      if (action === 'LOGIN') {
        app.user = data;
        app.initSession();
      }

    } catch (err) {
      console.error(err);
      alert('Backend bağlantı hatası');
    }
  },

  getPayload: (action) => {
    if (action === 'LOGIN') {
      return {
        username: document.getElementById('log-user').value,
        password: document.getElementById('log-pass').value
      };
    }
  },

  initSession: () => {
    document.getElementById('login-view').style.display = 'none';
    document.getElementById('app-view').style.display = 'block';
    document.getElementById('user-tag').innerText = app.user.username;
  }
};
</script>

</body>
</html>
